{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from \"react\";\nimport { db } from \"../firebase/config\";\nimport { collection, query, orderBy, onSnapshot, where } from \"firebase/firestore\";\nexport const useFetchDocuments = function (docCollection) {\n  _s();\n  let search = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  let uid = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  const [documents, setDocuments] = useState(null);\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(null);\n\n  // deal with memory leak\n  const [cancelled, setCancelled] = useState(false);\n  useEffect(() => {\n    async function loadData() {\n      if (cancelled) {\n        return;\n      }\n      setLoading(true);\n      const collectionRef = await collection(db, docCollection);\n      try {\n        let q;\n        if (search) {\n          q = await query(collectionRef, where(\"tags\", \"array-contains\", search), orderBy(\"createdAt\", \"desc\"));\n        } else if (uid) {\n          q = await query(collectionRef, where(\"uid\", \"==\", uid), orderBy(\"createdAt\", \"desc\"));\n        } else {\n          q = await query(collectionRef, orderBy(\"createdAt\", \"desc\"));\n        }\n        await onSnapshot(q, querySnapshot => {\n          setDocuments(querySnapshot.docs.map(doc => ({\n            id: doc.id,\n            ...doc.data()\n          })));\n        });\n      } catch (error) {\n        console.log(error);\n        setError(error.message);\n      }\n      setLoading(false);\n    }\n    loadData();\n  }, [docCollection, search, uid, cancelled]);\n  console.log(documents);\n  useEffect(() => {\n    return () => setCancelled(true);\n  }, []);\n  return {\n    documents,\n    loading,\n    error\n  };\n};\n_s(useFetchDocuments, \"oHQtMVeLQvU17FI2wc7iUGDhIAM=\");","map":{"version":3,"names":["useState","useEffect","db","collection","query","orderBy","onSnapshot","where","useFetchDocuments","docCollection","_s","search","arguments","length","undefined","uid","documents","setDocuments","error","setError","loading","setLoading","cancelled","setCancelled","loadData","collectionRef","q","querySnapshot","docs","map","doc","id","data","console","log","message"],"sources":["C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/src/hooks/useFetchDocuments.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport { db } from \"../firebase/config\";\nimport {\n  collection,\n  query,\n  orderBy,\n  onSnapshot,\n  where,\n} from \"firebase/firestore\";\n\nexport const useFetchDocuments = (docCollection, search = null, uid = null) => {\n  const [documents, setDocuments] = useState(null);\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(null);\n\n  // deal with memory leak\n  const [cancelled, setCancelled] = useState(false);\n\n  useEffect(() => {\n    async function loadData() {\n      if (cancelled) {\n        return;\n      }\n\n      setLoading(true);\n\n      const collectionRef = await collection(db, docCollection);\n\n      try {\n        let q;\n\n        if (search) {\n          q = await query(\n            collectionRef,\n            where(\"tags\", \"array-contains\", search),\n            orderBy(\"createdAt\", \"desc\")\n          );\n        } else if (uid) {\n          q = await query(\n            collectionRef,\n            where(\"uid\", \"==\", uid),\n            orderBy(\"createdAt\", \"desc\")\n          );\n        } else {\n          q = await query(collectionRef, orderBy(\"createdAt\", \"desc\"));\n        }\n\n        await onSnapshot(q, (querySnapshot) => {\n          setDocuments(\n            querySnapshot.docs.map((doc) => ({\n              id: doc.id,\n              ...doc.data(),\n            }))\n          );\n        });\n      } catch (error) {\n        console.log(error);\n        setError(error.message);\n      }\n\n      setLoading(false);\n    }\n\n    loadData();\n  }, [docCollection, search, uid, cancelled]);\n\n  console.log(documents);\n\n  useEffect(() => {\n    return () => setCancelled(true);\n  }, []);\n\n  return { documents, loading, error };\n};\n"],"mappings":";AAAA,SAASA,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAC3C,SAASC,EAAE,QAAQ,oBAAoB;AACvC,SACEC,UAAU,EACVC,KAAK,EACLC,OAAO,EACPC,UAAU,EACVC,KAAK,QACA,oBAAoB;AAE3B,OAAO,MAAMC,iBAAiB,GAAG,SAAAA,CAACC,aAAa,EAAgC;EAAAC,EAAA;EAAA,IAA9BC,MAAM,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAI;EAAA,IAAEG,GAAG,GAAAH,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,IAAI;EACxE,MAAM,CAACI,SAAS,EAAEC,YAAY,CAAC,GAAGjB,QAAQ,CAAC,IAAI,CAAC;EAChD,MAAM,CAACkB,KAAK,EAAEC,QAAQ,CAAC,GAAGnB,QAAQ,CAAC,IAAI,CAAC;EACxC,MAAM,CAACoB,OAAO,EAAEC,UAAU,CAAC,GAAGrB,QAAQ,CAAC,IAAI,CAAC;;EAE5C;EACA,MAAM,CAACsB,SAAS,EAAEC,YAAY,CAAC,GAAGvB,QAAQ,CAAC,KAAK,CAAC;EAEjDC,SAAS,CAAC,MAAM;IACd,eAAeuB,QAAQA,CAAA,EAAG;MACxB,IAAIF,SAAS,EAAE;QACb;MACF;MAEAD,UAAU,CAAC,IAAI,CAAC;MAEhB,MAAMI,aAAa,GAAG,MAAMtB,UAAU,CAACD,EAAE,EAAEO,aAAa,CAAC;MAEzD,IAAI;QACF,IAAIiB,CAAC;QAEL,IAAIf,MAAM,EAAE;UACVe,CAAC,GAAG,MAAMtB,KAAK,CACbqB,aAAa,EACblB,KAAK,CAAC,MAAM,EAAE,gBAAgB,EAAEI,MAAM,CAAC,EACvCN,OAAO,CAAC,WAAW,EAAE,MAAM,CAAC,CAC7B;QACH,CAAC,MAAM,IAAIU,GAAG,EAAE;UACdW,CAAC,GAAG,MAAMtB,KAAK,CACbqB,aAAa,EACblB,KAAK,CAAC,KAAK,EAAE,IAAI,EAAEQ,GAAG,CAAC,EACvBV,OAAO,CAAC,WAAW,EAAE,MAAM,CAAC,CAC7B;QACH,CAAC,MAAM;UACLqB,CAAC,GAAG,MAAMtB,KAAK,CAACqB,aAAa,EAAEpB,OAAO,CAAC,WAAW,EAAE,MAAM,CAAC,CAAC;QAC9D;QAEA,MAAMC,UAAU,CAACoB,CAAC,EAAGC,aAAa,IAAK;UACrCV,YAAY,CACVU,aAAa,CAACC,IAAI,CAACC,GAAG,CAAEC,GAAG,KAAM;YAC/BC,EAAE,EAAED,GAAG,CAACC,EAAE;YACV,GAAGD,GAAG,CAACE,IAAI;UACb,CAAC,CAAC,CAAC,CACJ;QACH,CAAC,CAAC;MACJ,CAAC,CAAC,OAAOd,KAAK,EAAE;QACde,OAAO,CAACC,GAAG,CAAChB,KAAK,CAAC;QAClBC,QAAQ,CAACD,KAAK,CAACiB,OAAO,CAAC;MACzB;MAEAd,UAAU,CAAC,KAAK,CAAC;IACnB;IAEAG,QAAQ,EAAE;EACZ,CAAC,EAAE,CAACf,aAAa,EAAEE,MAAM,EAAEI,GAAG,EAAEO,SAAS,CAAC,CAAC;EAE3CW,OAAO,CAACC,GAAG,CAAClB,SAAS,CAAC;EAEtBf,SAAS,CAAC,MAAM;IACd,OAAO,MAAMsB,YAAY,CAAC,IAAI,CAAC;EACjC,CAAC,EAAE,EAAE,CAAC;EAEN,OAAO;IAAEP,SAAS;IAAEI,OAAO;IAAEF;EAAM,CAAC;AACtC,CAAC;AAACR,EAAA,CA/DWF,iBAAiB"},"metadata":{},"sourceType":"module","externalDependencies":[]}