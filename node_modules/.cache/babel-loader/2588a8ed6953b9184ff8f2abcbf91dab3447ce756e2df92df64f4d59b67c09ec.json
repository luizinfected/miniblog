{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect,useReducer}from\"react\";import{db}from\"../firebase/config\";import{updateDoc,doc}from\"firebase/firestore\";var initialState={loading:null,error:null};var updateReducer=function updateReducer(state,action){switch(action.type){case\"LOADING\":return{loading:true,error:null};case\"UPDATED_DOC\":return{loading:false,error:null};case\"ERROR\":return{loading:false,error:action.payload};default:return state;}};export var useUpdateDocument=function useUpdateDocument(docCollection){var _useReducer=useReducer(updateReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),response=_useReducer2[0],dispatch=_useReducer2[1];// deal with memory leak\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),cancelled=_useState2[0],setCancelled=_useState2[1];var checkCancelBeforeDispatch=function checkCancelBeforeDispatch(action){if(!cancelled){dispatch(action);}};var updateDocument=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(uid,data){var docRef,updatedDocument;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:checkCancelBeforeDispatch({type:\"LOADING\"});_context.prev=1;_context.next=4;return doc(db,docCollection,uid);case 4:docRef=_context.sent;console.log(docRef);_context.next=8;return updateDoc(docRef,data);case 8:updatedDocument=_context.sent;console.log(updateDocument);checkCancelBeforeDispatch({type:\"UPDATED_DOC\",payload:updatedDocument});_context.next=17;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](1);console.log(_context.t0);checkCancelBeforeDispatch({type:\"ERROR\",payload:_context.t0.message});case 17:case\"end\":return _context.stop();}},_callee,null,[[1,13]]);}));return function updateDocument(_x,_x2){return _ref.apply(this,arguments);};}();useEffect(function(){return function(){return setCancelled(true);};},[]);return{updateDocument:updateDocument,response:response};};","map":{"version":3,"names":["useState","useEffect","useReducer","db","updateDoc","doc","initialState","loading","error","updateReducer","state","action","type","payload","useUpdateDocument","docCollection","_useReducer","_useReducer2","_slicedToArray","response","dispatch","_useState","_useState2","cancelled","setCancelled","checkCancelBeforeDispatch","updateDocument","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","uid","data","docRef","updatedDocument","wrap","_callee$","_context","prev","next","sent","console","log","t0","message","stop","_x","_x2","apply","arguments"],"sources":["C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/src/hooks/useUpdateDocument.js"],"sourcesContent":["import { useState, useEffect, useReducer } from \"react\";\nimport { db } from \"../firebase/config\";\nimport { updateDoc, doc } from \"firebase/firestore\";\n\nconst initialState = {\n  loading: null,\n  error: null,\n};\n\nconst updateReducer = (state, action) => {\n  switch (action.type) {\n    case \"LOADING\":\n      return { loading: true, error: null };\n    case \"UPDATED_DOC\":\n      return { loading: false, error: null };\n    case \"ERROR\":\n      return { loading: false, error: action.payload };\n    default:\n      return state;\n  }\n};\n\nexport const useUpdateDocument = (docCollection) => {\n  const [response, dispatch] = useReducer(updateReducer, initialState);\n\n  // deal with memory leak\n  const [cancelled, setCancelled] = useState(false);\n\n  const checkCancelBeforeDispatch = (action) => {\n    if (!cancelled) {\n      dispatch(action);\n    }\n  };\n\n  const updateDocument = async (uid, data) => {\n    checkCancelBeforeDispatch({ type: \"LOADING\" });\n\n    try {\n      const docRef = await doc(db, docCollection, uid);\n\n      console.log(docRef);\n\n      const updatedDocument = await updateDoc(docRef, data);\n\n      console.log(updateDocument);\n\n      checkCancelBeforeDispatch({\n        type: \"UPDATED_DOC\",\n        payload: updatedDocument,\n      });\n    } catch (error) {\n      console.log(error);\n      checkCancelBeforeDispatch({ type: \"ERROR\", payload: error.message });\n    }\n  };\n\n  useEffect(() => {\n    return () => setCancelled(true);\n  }, []);\n\n  return { updateDocument, response };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}