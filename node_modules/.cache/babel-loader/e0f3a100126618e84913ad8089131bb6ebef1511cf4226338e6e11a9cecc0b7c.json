{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect,useReducer}from\"react\";import{db}from\"../firebase/config\";import{doc,deleteDoc}from\"firebase/firestore\";var initialState={loading:null,error:null};var deleteReducer=function deleteReducer(state,action){switch(action.type){case\"LOADING\":return{loading:true,error:null};case\"DELETED_DOC\":return{loading:false,error:null};case\"ERROR\":return{loading:false,error:action.payload};default:return state;}};export var useDeleteDocument=function useDeleteDocument(docCollection){var _useReducer=useReducer(deleteReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),response=_useReducer2[0],dispatch=_useReducer2[1];// deal with memory leak\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),cancelled=_useState2[0],setCancelled=_useState2[1];var checkCancelBeforeDispatch=function checkCancelBeforeDispatch(action){if(!cancelled){dispatch(action);}};var deleteDocument=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(id){var deletedDocument;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:checkCancelBeforeDispatch({type:\"LOADING\"});_context.prev=1;_context.next=4;return deleteDoc(doc(db,docCollection,id));case 4:deletedDocument=_context.sent;checkCancelBeforeDispatch({type:\"DELETED_DOC\",payload:deletedDocument});_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](1);checkCancelBeforeDispatch({type:\"ERROR\",payload:_context.t0.message});case 11:case\"end\":return _context.stop();}},_callee,null,[[1,8]]);}));return function deleteDocument(_x){return _ref.apply(this,arguments);};}();useEffect(function(){return function(){return setCancelled(true);};},[]);return{deleteDocument:deleteDocument,response:response};};","map":{"version":3,"names":["useState","useEffect","useReducer","db","doc","deleteDoc","initialState","loading","error","deleteReducer","state","action","type","payload","useDeleteDocument","docCollection","_useReducer","_useReducer2","_slicedToArray","response","dispatch","_useState","_useState2","cancelled","setCancelled","checkCancelBeforeDispatch","deleteDocument","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","id","deletedDocument","wrap","_callee$","_context","prev","next","sent","t0","message","stop","_x","apply","arguments"],"sources":["C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/src/hooks/useDeleteDocument.js"],"sourcesContent":["import { useState, useEffect, useReducer } from \"react\";\nimport { db } from \"../firebase/config\";\nimport { doc, deleteDoc } from \"firebase/firestore\";\n\nconst initialState = {\n  loading: null,\n  error: null,\n};\n\nconst deleteReducer = (state, action) => {\n  switch (action.type) {\n    case \"LOADING\":\n      return { loading: true, error: null };\n    case \"DELETED_DOC\":\n      return { loading: false, error: null };\n    case \"ERROR\":\n      return { loading: false, error: action.payload };\n    default:\n      return state;\n  }\n};\n\nexport const useDeleteDocument = (docCollection) => {\n  const [response, dispatch] = useReducer(deleteReducer, initialState);\n\n  // deal with memory leak\n  const [cancelled, setCancelled] = useState(false);\n\n  const checkCancelBeforeDispatch = (action) => {\n    if (!cancelled) {\n      dispatch(action);\n    }\n  };\n\n  const deleteDocument = async (id) => {\n    checkCancelBeforeDispatch({ type: \"LOADING\" });\n\n    try {\n      const deletedDocument = await deleteDoc(doc(db, docCollection, id));\n\n      checkCancelBeforeDispatch({\n        type: \"DELETED_DOC\",\n        payload: deletedDocument,\n      });\n    } catch (error) {\n      checkCancelBeforeDispatch({ type: \"ERROR\", payload: error.message });\n    }\n  };\n\n  useEffect(() => {\n    return () => setCancelled(true);\n  }, []);\n\n  return { deleteDocument, response };\n};\n"],"mappings":"qaAAA,OAASA,QAAQ,CAAEC,SAAS,CAAEC,UAAU,KAAQ,OAAO,CACvD,OAASC,EAAE,KAAQ,oBAAoB,CACvC,OAASC,GAAG,CAAEC,SAAS,KAAQ,oBAAoB,CAEnD,GAAM,CAAAC,YAAY,CAAG,CACnBC,OAAO,CAAE,IAAI,CACbC,KAAK,CAAE,IACT,CAAC,CAED,GAAM,CAAAC,aAAa,CAAG,QAAhB,CAAAA,aAAaA,CAAIC,KAAK,CAAEC,MAAM,CAAK,CACvC,OAAQA,MAAM,CAACC,IAAI,EACjB,IAAK,SAAS,CACZ,MAAO,CAAEL,OAAO,CAAE,IAAI,CAAEC,KAAK,CAAE,IAAK,CAAC,CACvC,IAAK,aAAa,CAChB,MAAO,CAAED,OAAO,CAAE,KAAK,CAAEC,KAAK,CAAE,IAAK,CAAC,CACxC,IAAK,OAAO,CACV,MAAO,CAAED,OAAO,CAAE,KAAK,CAAEC,KAAK,CAAEG,MAAM,CAACE,OAAQ,CAAC,CAClD,QACE,MAAO,CAAAH,KAAK,CAAC,CAEnB,CAAC,CAED,MAAO,IAAM,CAAAI,iBAAiB,CAAG,QAApB,CAAAA,iBAAiBA,CAAIC,aAAa,CAAK,CAClD,IAAAC,WAAA,CAA6Bd,UAAU,CAACO,aAAa,CAAEH,YAAY,CAAC,CAAAW,YAAA,CAAAC,cAAA,CAAAF,WAAA,IAA7DG,QAAQ,CAAAF,YAAA,IAAEG,QAAQ,CAAAH,YAAA,IAEzB;AACA,IAAAI,SAAA,CAAkCrB,QAAQ,CAAC,KAAK,CAAC,CAAAsB,UAAA,CAAAJ,cAAA,CAAAG,SAAA,IAA1CE,SAAS,CAAAD,UAAA,IAAEE,YAAY,CAAAF,UAAA,IAE9B,GAAM,CAAAG,yBAAyB,CAAG,QAA5B,CAAAA,yBAAyBA,CAAId,MAAM,CAAK,CAC5C,GAAI,CAACY,SAAS,CAAE,CACdH,QAAQ,CAACT,MAAM,CAAC,CAClB,CACF,CAAC,CAED,GAAM,CAAAe,cAAc,6BAAAC,IAAA,CAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAOC,EAAE,MAAAC,eAAA,QAAAJ,mBAAA,GAAAK,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,SAC9Bb,yBAAyB,CAAC,CAAEb,IAAI,CAAE,SAAU,CAAC,CAAC,CAACwB,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA,SAGf,CAAAjC,SAAS,CAACD,GAAG,CAACD,EAAE,CAAEY,aAAa,CAAEiB,EAAE,CAAC,CAAC,QAA7DC,eAAe,CAAAG,QAAA,CAAAG,IAAA,CAErBd,yBAAyB,CAAC,CACxBb,IAAI,CAAE,aAAa,CACnBC,OAAO,CAAEoB,eACX,CAAC,CAAC,CAACG,QAAA,CAAAE,IAAA,iBAAAF,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAI,EAAA,CAAAJ,QAAA,aAEHX,yBAAyB,CAAC,CAAEb,IAAI,CAAE,OAAO,CAAEC,OAAO,CAAEuB,QAAA,CAAAI,EAAA,CAAMC,OAAQ,CAAC,CAAC,CAAC,yBAAAL,QAAA,CAAAM,IAAA,MAAAX,OAAA,gBAExE,kBAbK,CAAAL,cAAcA,CAAAiB,EAAA,SAAAhB,IAAA,CAAAiB,KAAA,MAAAC,SAAA,OAanB,CAED5C,SAAS,CAAC,UAAM,CACd,MAAO,kBAAM,CAAAuB,YAAY,CAAC,IAAI,CAAC,GACjC,CAAC,CAAE,EAAE,CAAC,CAEN,MAAO,CAAEE,cAAc,CAAdA,cAAc,CAAEP,QAAQ,CAARA,QAAS,CAAC,CACrC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}