{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from\"react\";import{db}from\"../firebase/config\";import{collection,query,orderBy,onSnapshot,where}from\"firebase/firestore\";export var useFetchDocuments=function useFetchDocuments(docCollection){var search=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var uid=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),documents=_useState2[0],setDocuments=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];// deal with memory leak\nvar _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),cancelled=_useState8[0],setCancelled=_useState8[1];useEffect(function(){function loadData(){return _loadData.apply(this,arguments);}function _loadData(){_loadData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var collectionRef,q;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!cancelled){_context.next=2;break;}return _context.abrupt(\"return\");case 2:setLoading(true);_context.next=5;return collection(db,docCollection);case 5:collectionRef=_context.sent;_context.prev=6;if(!search){_context.next=13;break;}_context.next=10;return query(collectionRef,where(\"tags\",\"array-contains\",search),orderBy(\"createdAt\",\"desc\"));case 10:q=_context.sent;_context.next=22;break;case 13:if(!uid){_context.next=19;break;}_context.next=16;return query(collectionRef,where(\"uid\",\"==\",uid),orderBy(\"createdAt\",\"desc\"));case 16:q=_context.sent;_context.next=22;break;case 19:_context.next=21;return query(collectionRef,orderBy(\"createdAt\",\"desc\"));case 21:q=_context.sent;case 22:_context.next=24;return onSnapshot(q,function(querySnapshot){setDocuments(querySnapshot.docs.map(function(doc){return _objectSpread({id:doc.id},doc.data());}));});case 24:_context.next=30;break;case 26:_context.prev=26;_context.t0=_context[\"catch\"](6);console.log(_context.t0);setError(_context.t0.message);case 30:setLoading(false);case 31:case\"end\":return _context.stop();}},_callee,null,[[6,26]]);}));return _loadData.apply(this,arguments);}loadData();},[docCollection,search,uid,cancelled]);console.log(documents);useEffect(function(){return function(){return setCancelled(true);};},[]);return{documents:documents,loading:loading,error:error};};","map":{"version":3,"names":["useState","useEffect","db","collection","query","orderBy","onSnapshot","where","useFetchDocuments","docCollection","search","arguments","length","undefined","uid","_useState","_useState2","_slicedToArray","documents","setDocuments","_useState3","_useState4","error","setError","_useState5","_useState6","loading","setLoading","_useState7","_useState8","cancelled","setCancelled","loadData","_loadData","apply","_asyncToGenerator","_regeneratorRuntime","mark","_callee","collectionRef","q","wrap","_callee$","_context","prev","next","abrupt","sent","querySnapshot","docs","map","doc","_objectSpread","id","data","t0","console","log","message","stop"],"sources":["C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/src/hooks/useFetchDocuments.js"],"sourcesContent":["import { useState, useEffect } from \"react\";\nimport { db } from \"../firebase/config\";\nimport {\n  collection,\n  query,\n  orderBy,\n  onSnapshot,\n  where,\n} from \"firebase/firestore\";\n\nexport const useFetchDocuments = (docCollection, search = null, uid = null) => {\n  const [documents, setDocuments] = useState(null);\n  const [error, setError] = useState(null);\n  const [loading, setLoading] = useState(null);\n\n  // deal with memory leak\n  const [cancelled, setCancelled] = useState(false);\n\n  useEffect(() => {\n    async function loadData() {\n      if (cancelled) {\n        return;\n      }\n\n      setLoading(true);\n\n      const collectionRef = await collection(db, docCollection);\n\n      try {\n        let q;\n\n        if (search) {\n          q = await query(\n            collectionRef,\n            where(\"tags\", \"array-contains\", search),\n            orderBy(\"createdAt\", \"desc\")\n          );\n        } else if (uid) {\n          q = await query(\n            collectionRef,\n            where(\"uid\", \"==\", uid),\n            orderBy(\"createdAt\", \"desc\")\n          );\n        } else {\n          q = await query(collectionRef, orderBy(\"createdAt\", \"desc\"));\n        }\n\n        await onSnapshot(q, (querySnapshot) => {\n          setDocuments(\n            querySnapshot.docs.map((doc) => ({\n              id: doc.id,\n              ...doc.data(),\n            }))\n          );\n        });\n      } catch (error) {\n        console.log(error);\n        setError(error.message);\n      }\n\n      setLoading(false);\n    }\n\n    loadData();\n  }, [docCollection, search, uid, cancelled]);\n\n  console.log(documents);\n\n  useEffect(() => {\n    return () => setCancelled(true);\n  }, []);\n\n  return { documents, loading, error };\n};\n"],"mappings":"2iBAAA,OAASA,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC3C,OAASC,EAAE,KAAQ,oBAAoB,CACvC,OACEC,UAAU,CACVC,KAAK,CACLC,OAAO,CACPC,UAAU,CACVC,KAAK,KACA,oBAAoB,CAE3B,MAAO,IAAM,CAAAC,iBAAiB,CAAG,QAApB,CAAAA,iBAAiBA,CAAIC,aAAa,CAAgC,IAA9B,CAAAC,MAAM,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,IAAI,IAAE,CAAAG,GAAG,CAAAH,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,IAAI,CACxE,IAAAI,SAAA,CAAkCf,QAAQ,CAAC,IAAI,CAAC,CAAAgB,UAAA,CAAAC,cAAA,CAAAF,SAAA,IAAzCG,SAAS,CAAAF,UAAA,IAAEG,YAAY,CAAAH,UAAA,IAC9B,IAAAI,UAAA,CAA0BpB,QAAQ,CAAC,IAAI,CAAC,CAAAqB,UAAA,CAAAJ,cAAA,CAAAG,UAAA,IAAjCE,KAAK,CAAAD,UAAA,IAAEE,QAAQ,CAAAF,UAAA,IACtB,IAAAG,UAAA,CAA8BxB,QAAQ,CAAC,IAAI,CAAC,CAAAyB,UAAA,CAAAR,cAAA,CAAAO,UAAA,IAArCE,OAAO,CAAAD,UAAA,IAAEE,UAAU,CAAAF,UAAA,IAE1B;AACA,IAAAG,UAAA,CAAkC5B,QAAQ,CAAC,KAAK,CAAC,CAAA6B,UAAA,CAAAZ,cAAA,CAAAW,UAAA,IAA1CE,SAAS,CAAAD,UAAA,IAAEE,YAAY,CAAAF,UAAA,IAE9B5B,SAAS,CAAC,UAAM,SACC,CAAA+B,QAAQA,CAAA,SAAAC,SAAA,CAAAC,KAAA,MAAAvB,SAAA,YAAAsB,UAAA,EAAAA,SAAA,CAAAE,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAvB,SAAAC,QAAA,MAAAC,aAAA,CAAAC,CAAA,QAAAJ,mBAAA,GAAAK,IAAA,UAAAC,SAAAC,QAAA,iBAAAA,QAAA,CAAAC,IAAA,CAAAD,QAAA,CAAAE,IAAA,aACMf,SAAS,EAAAa,QAAA,CAAAE,IAAA,iBAAAF,QAAA,CAAAG,MAAA,kBAIbnB,UAAU,CAAC,IAAI,CAAC,CAACgB,QAAA,CAAAE,IAAA,SAEW,CAAA1C,UAAU,CAACD,EAAE,CAAEO,aAAa,CAAC,QAAnD8B,aAAa,CAAAI,QAAA,CAAAI,IAAA,CAAAJ,QAAA,CAAAC,IAAA,OAKblC,MAAM,EAAAiC,QAAA,CAAAE,IAAA,WAAAF,QAAA,CAAAE,IAAA,UACE,CAAAzC,KAAK,CACbmC,aAAa,CACbhC,KAAK,CAAC,MAAM,CAAE,gBAAgB,CAAEG,MAAM,CAAC,CACvCL,OAAO,CAAC,WAAW,CAAE,MAAM,CAAC,CAC7B,SAJDmC,CAAC,CAAAG,QAAA,CAAAI,IAAA,CAAAJ,QAAA,CAAAE,IAAA,sBAKQ/B,GAAG,EAAA6B,QAAA,CAAAE,IAAA,WAAAF,QAAA,CAAAE,IAAA,UACF,CAAAzC,KAAK,CACbmC,aAAa,CACbhC,KAAK,CAAC,KAAK,CAAE,IAAI,CAAEO,GAAG,CAAC,CACvBT,OAAO,CAAC,WAAW,CAAE,MAAM,CAAC,CAC7B,SAJDmC,CAAC,CAAAG,QAAA,CAAAI,IAAA,CAAAJ,QAAA,CAAAE,IAAA,kBAAAF,QAAA,CAAAE,IAAA,UAMS,CAAAzC,KAAK,CAACmC,aAAa,CAAElC,OAAO,CAAC,WAAW,CAAE,MAAM,CAAC,CAAC,SAA5DmC,CAAC,CAAAG,QAAA,CAAAI,IAAA,SAAAJ,QAAA,CAAAE,IAAA,UAGG,CAAAvC,UAAU,CAACkC,CAAC,CAAE,SAACQ,aAAa,CAAK,CACrC7B,YAAY,CACV6B,aAAa,CAACC,IAAI,CAACC,GAAG,CAAC,SAACC,GAAG,SAAAC,aAAA,EACzBC,EAAE,CAAEF,GAAG,CAACE,EAAE,EACPF,GAAG,CAACG,IAAI,EAAE,GACb,CAAC,CACJ,CACH,CAAC,CAAC,SAAAX,QAAA,CAAAE,IAAA,kBAAAF,QAAA,CAAAC,IAAA,IAAAD,QAAA,CAAAY,EAAA,CAAAZ,QAAA,aAEFa,OAAO,CAACC,GAAG,CAAAd,QAAA,CAAAY,EAAA,CAAO,CAClBhC,QAAQ,CAACoB,QAAA,CAAAY,EAAA,CAAMG,OAAO,CAAC,CAAC,QAG1B/B,UAAU,CAAC,KAAK,CAAC,CAAC,yBAAAgB,QAAA,CAAAgB,IAAA,MAAArB,OAAA,iBACnB,UAAAL,SAAA,CAAAC,KAAA,MAAAvB,SAAA,GAEDqB,QAAQ,EAAE,CACZ,CAAC,CAAE,CAACvB,aAAa,CAAEC,MAAM,CAAEI,GAAG,CAAEgB,SAAS,CAAC,CAAC,CAE3C0B,OAAO,CAACC,GAAG,CAACvC,SAAS,CAAC,CAEtBjB,SAAS,CAAC,UAAM,CACd,MAAO,kBAAM,CAAA8B,YAAY,CAAC,IAAI,CAAC,GACjC,CAAC,CAAE,EAAE,CAAC,CAEN,MAAO,CAAEb,SAAS,CAATA,SAAS,CAAEQ,OAAO,CAAPA,OAAO,CAAEJ,KAAK,CAALA,KAAM,CAAC,CACtC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}