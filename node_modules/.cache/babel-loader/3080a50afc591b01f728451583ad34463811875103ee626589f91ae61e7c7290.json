{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect,useReducer}from\"react\";import{db}from\"../firebase/config\";import{collection,addDoc,Timestamp}from\"firebase/firestore\";var initialState={loading:null,error:null};var insertReducer=function insertReducer(state,action){switch(action.type){case\"LOADING\":return{loading:true,error:null};case\"INSERTED_DOC\":return{loading:false,error:null};case\"ERROR\":return{loading:false,error:action.payload};default:return state;}};export var useInsertDocument=function useInsertDocument(docCollection){var _useReducer=useReducer(insertReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),response=_useReducer2[0],dispatch=_useReducer2[1];// deal with memory leak\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),cancelled=_useState2[0],setCancelled=_useState2[1];var checkCancelBeforeDispatch=function checkCancelBeforeDispatch(action){if(!cancelled){dispatch(action);}};var insertDocument=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(document){var newDocument,insertedDocument;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:checkCancelBeforeDispatch({type:\"LOADING\"});_context.prev=1;newDocument=_objectSpread(_objectSpread({},document),{},{createdAt:Timestamp.now()});_context.next=5;return addDoc(collection(db,docCollection),newDocument);case 5:insertedDocument=_context.sent;checkCancelBeforeDispatch({type:\"INSERTED_DOC\",payload:insertedDocument});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);checkCancelBeforeDispatch({type:\"ERROR\",payload:_context.t0.message});case 12:case\"end\":return _context.stop();}},_callee,null,[[1,9]]);}));return function insertDocument(_x){return _ref.apply(this,arguments);};}();useEffect(function(){return function(){return setCancelled(true);};},[]);return{insertDocument:insertDocument,response:response};};","map":{"version":3,"names":["useState","useEffect","useReducer","db","collection","addDoc","Timestamp","initialState","loading","error","insertReducer","state","action","type","payload","useInsertDocument","docCollection","_useReducer","_useReducer2","_slicedToArray","response","dispatch","_useState","_useState2","cancelled","setCancelled","checkCancelBeforeDispatch","insertDocument","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","document","newDocument","insertedDocument","wrap","_callee$","_context","prev","next","_objectSpread","createdAt","now","sent","t0","message","stop","_x","apply","arguments"],"sources":["C:/Users/Luiz.E.Costa/Desktop/Code/Curso/miniblog/src/hooks/useInsertDocument.js"],"sourcesContent":["import { useState, useEffect, useReducer } from \"react\";\nimport { db } from \"../firebase/config\";\nimport { collection, addDoc, Timestamp } from \"firebase/firestore\";\n\nconst initialState = {\n  loading: null,\n  error: null,\n};\n\nconst insertReducer = (state, action) => {\n  switch (action.type) {\n    case \"LOADING\":\n      return { loading: true, error: null };\n    case \"INSERTED_DOC\":\n      return { loading: false, error: null };\n    case \"ERROR\":\n      return { loading: false, error: action.payload };\n    default:\n      return state;\n  }\n};\n\nexport const useInsertDocument = (docCollection) => {\n  const [response, dispatch] = useReducer(insertReducer, initialState);\n\n  // deal with memory leak\n  const [cancelled, setCancelled] = useState(false);\n\n  const checkCancelBeforeDispatch = (action) => {\n    if (!cancelled) {\n      dispatch(action);\n    }\n  };\n\n  const insertDocument = async (document) => {\n    checkCancelBeforeDispatch({ type: \"LOADING\" });\n\n    try {\n      const newDocument = { ...document, createdAt: Timestamp.now() };\n\n      const insertedDocument = await addDoc(\n        collection(db, docCollection),\n        newDocument\n      );\n\n      checkCancelBeforeDispatch({\n        type: \"INSERTED_DOC\",\n        payload: insertedDocument,\n      });\n    } catch (error) {\n      checkCancelBeforeDispatch({ type: \"ERROR\", payload: error.message });\n    }\n  };\n\n  useEffect(() => {\n    return () => setCancelled(true);\n  }, []);\n\n  return { insertDocument, response };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}